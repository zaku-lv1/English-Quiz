<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºŒå­¦æœŸä¸­é–“è€ƒæŸ»ãƒ¦ãƒ¡ã‚¿ãƒ³</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', 'Helvetica Neue', 'Arial', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', 'BIZ UDPGothic', sans-serif;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 p-4 sm:p-6 md:p-8">
    <div class="max-w-xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">äºŒå­¦æœŸä¸­é–“è€ƒæŸ»ãƒ¦ãƒ¡ã‚¿ãƒ³</h1>
            <p class="mt-2 text-slate-600">æ—¥æœ¬èªã®æ„å‘³ã«åˆã†è‹±å˜èªã‚’æ›¸ã„ã¦ã¿ã‚ˆã†ï¼</p>
        </header>

        <!-- Quiz Area -->
        <div id="quiz-area" class="bg-white p-6 rounded-xl shadow-md min-h-[300px] flex flex-col justify-between">
            <div id="progress-indicator" class="text-right text-sm text-slate-500 mb-4 font-medium"></div>
            <div id="question-container" class="text-lg flex-grow flex flex-col justify-center">
                <!-- Question content will be injected here -->
            </div>
            <div id="feedback-container" class="mt-4 font-bold text-center h-12">
                <!-- Feedback like "Correct!" or "Incorrect" will appear here -->
            </div>
        </div>

        <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="result-container" class="hidden mt-8 text-center bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-3xl font-bold text-slate-800">ãƒ†ã‚¹ãƒˆçµæœ</h2>
            <p id="score" class="text-2xl mt-4"></p>
            <p id="feedback-message" class="text-lg mt-2 font-medium"></p>
            <!-- é–“é•ãˆãŸå˜èªãƒªã‚¹ãƒˆ -->
            <div id="mistake-list-container" class="mt-6"></div>
            <!-- å¾©ç¿’ãƒœã‚¿ãƒ³ -->
            <button id="review-btn" class="bg-pink-500 text-white font-bold py-2 px-6 rounded-lg mt-4 hover:bg-pink-600 transition hidden">é–“é•ãˆãŸå•é¡Œã ã‘å¾©ç¿’ã™ã‚‹</button>
        </div>

        <!-- é€”ä¸­ç¢ºèªã‚¨ãƒªã‚¢ -->
        <div id="mistake-check-container" class="hidden mt-8 text-center bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold text-slate-800 mb-2">é–“é•ã£ãŸå˜èªãƒªã‚¹ãƒˆï¼ˆã“ã“ã¾ã§ï¼‰</h2>
            <div id="current-mistake-list" class="mb-4"></div>
            <button id="close-mistake-check" class="bg-sky-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-sky-600 transition">é–‰ã˜ã‚‹</button>
            <!-- è¿½åŠ ï¼šã“ã“ã¾ã§ã®é–“é•ã„ã§å¾©ç¿’ãƒœã‚¿ãƒ³ -->
            <button id="mid-review-btn" class="bg-pink-500 text-white font-bold py-2 px-6 rounded-lg mt-4 hover:bg-pink-600 transition">ã“ã“ã¾ã§ã®é–“é•ã„ã ã‘ã§å¾©ç¿’ã™ã‚‹</button>
        </div>

        <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
        <div id="control-buttons" class="mt-6 text-center space-x-2 sm:space-x-4">
            <button id="check-btn" class="bg-sky-600 text-white font-bold py-3 px-6 sm:px-8 rounded-lg shadow-md hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-50 transition-transform transform hover:scale-105">å›ç­”ã‚’ç¢ºèª</button>
            <button id="next-btn" class="bg-green-600 text-white font-bold py-3 px-6 sm:px-8 rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition-transform transform hover:scale-105 hidden">æ¬¡ã®å•é¡Œã¸</button>
            <button id="mistake-check-btn" class="bg-yellow-500 text-white font-bold py-3 px-4 sm:px-6 text-sm sm:text-base rounded-lg shadow-md hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-opacity-50 transition-transform transform hover:scale-105">é€”ä¸­ã®é–“é•ã„ç¢ºèª</button>
            <button id="reset-btn" class="bg-slate-500 text-white font-bold py-3 px-6 sm:px-8 rounded-lg shadow-md hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-opacity-50 transition-transform transform hover:scale-105">ã‚‚ã†ä¸€åº¦</button>
        </div>
    </div>

    <script>
        // å•é¡Œãƒ‡ãƒ¼ã‚¿
        const wordList = [
            {"en":"peninsula","ja":"åŠå³¶"},{"en":"approach","ja":"ã€œã«è¿‘ã¥ã"},{"en":"citizen","ja":"å¸‚æ°‘"},{"en":"pavement","ja":"èˆ—è£…é“è·¯"},{"en":"assume","ja":"ã€œã‚’æƒ³å®šã™ã‚‹"},{"en":"slave","ja":"å¥´éš·"},{"en":"origin","ja":"èµ·æº"},{"en":"separate","ja":"ã€œã‚’åˆ†ã‘ã‚‹"},{"en":"progress","ja":"é€²æ­©"},{"en":"profit","ja":"åˆ©ç›Š"},
            {"en":"voyage","ja":"èˆªæµ·"},{"en":"found","ja":"ã€œã®åŸºç¤ã‚’ç¯‰ã"},{"en":"tribe","ja":"ç¨®æ—"},{"en":"transportation","ja":"ç§»å‹•æ‰‹æ®µ"},{"en":"mankind","ja":"äººé¡"},{"en":"heritage","ja":"éºç”£"},{"en":"descendant","ja":"å­å­«"},{"en":"civilization","ja":"æ–‡æ˜"},{"en":"era","ja":"æ™‚ä»£"},{"en":"appear","ja":"ç¾ã‚Œã‚‹"},
            {"en":"congress","ja":"è­°ä¼š"},{"en":"district","ja":"åœ°åŒº"},{"en":"colony","ja":"æ¤æ°‘åœ°"},{"en":"destination","ja":"ç›®çš„åœ°"},{"en":"declare","ja":"ã€œã‚’å®£è¨€ã™ã‚‹"},{"en":"ape","ja":"é¡äººçŒ¿"},{"en":"cliff","ja":"å´–"},{"en":"afford","ja":"ã€œã™ã‚‹ä½™è£•ãŒã‚ã‚‹"},{"en":"tradition","ja":"ä¼çµ±"},{"en":"prosperity","ja":"ç¹æ „"},
            {"en":"nationality","ja":"å›½ç±"},{"en":"occupation","ja":"è·æ¥­"},{"en":"term","ja":"å°‚é–€ç”¨èª"},{"en":"province","ja":"åœ°æ–¹"},{"en":"ruin","ja":"ã€œã‚’ç ´æ»…ã•ã›ã‚‹"},{"en":"translate","ja":"ã€œã‚’ç¿»è¨³ã™ã‚‹"},{"en":"ancestor","ja":"å…ˆç¥–"},{"en":"fare","ja":"é‹è³ƒ"},{"en":"remain","ja":"ä¾ç„¶ã¨ã—ã¦ã€œã®ã¾ã¾ã§ã‚ã‚‹"},{"en":"media","ja":"ãƒã‚¹ãƒ¡ãƒ‡ã‚£ã‚¢"},
            // ...ï¼ˆå…¨ãƒªã‚¹ãƒˆè²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼‰
            {"en":"score","ja":"å¾—ç‚¹"}
        ];

        // ã‚¯ã‚¤ã‚ºé€²è¡Œç”¨ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let allQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let mistakes = [];
        let reviewMode = false;
        let reviewQuestions = [];

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function initializeQuiz(questions = null) {
            if (questions) {
                allQuestions = shuffle(questions.map(q => ({...q})));
            } else {
                allQuestions = shuffle(wordList.map(word => ({
                    question: word.ja,
                    answer: word.en
                })));
            }
            currentQuestionIndex = 0;
            score = 0;
            mistakes = [];
            document.getElementById('quiz-area').classList.remove('hidden');
            document.getElementById('control-buttons').classList.remove('hidden');
            document.getElementById('result-container').classList.add('hidden');
            document.getElementById('mistake-check-container').classList.add('hidden');
            displayQuestion();
        }

        function displayQuestion() {
            if (currentQuestionIndex >= allQuestions.length) {
                showResults();
                return;
            }
            document.getElementById('progress-indicator').textContent = `å•é¡Œ ${currentQuestionIndex + 1} / ${allQuestions.length}`;
            const questionContainer = document.getElementById('question-container');
            const feedbackContainer = document.getElementById('feedback-container');
            questionContainer.innerHTML = '';
            feedbackContainer.innerHTML = '';
            const q = allQuestions[currentQuestionIndex];
            const questionHTML = `
                <label for="spell-input" class="block text-center text-xl font-medium text-slate-700 mb-4">${q.question}</label>
                <div class="relative max-w-sm mx-auto">
                    <input type="text" id="spell-input" class="text-center mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-lg" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
                </div>
            `;
            questionContainer.innerHTML = questionHTML;
            document.getElementById('check-btn').classList.remove('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            const spellInput = document.getElementById('spell-input');
            spellInput.focus();
            spellInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('check-btn').click();
                }
            });
        }

        function checkAnswer() {
            const q = allQuestions[currentQuestionIndex];
            const feedbackContainer = document.getElementById('feedback-container');
            const input = document.getElementById('spell-input');
            const userAnswer = input.value.trim().toLowerCase();
            const isCorrect = (userAnswer === q.answer.toLowerCase());
            input.disabled = true;
            if (isCorrect) {
                score++;
                feedbackContainer.innerHTML = `<span class="text-green-600 text-2xl">æ­£è§£ï¼ â—‹</span>`;
            } else {
                feedbackContainer.innerHTML = `<span class="text-red-600 text-2xl">ä¸æ­£è§£ Ã—</span><p class="text-slate-700 mt-1">æ­£è§£ã¯: ${q.answer}</p>`;
                mistakes.push({
                    question: q.question,
                    answer: q.answer,
                    userAnswer: input.value
                });
            }
            document.getElementById('check-btn').classList.add('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
            document.getElementById('next-btn').focus();
        }

        function nextQuestion() {
            currentQuestionIndex++;
            displayQuestion();
        }

        function showResults() {
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('control-buttons').classList.add('hidden');
            const resultContainer = document.getElementById('result-container');
            resultContainer.classList.remove('hidden');
            const totalQuestions = allQuestions.length;
            document.getElementById('score').innerText = `æ­£è§£æ•°: ${score} / ${totalQuestions}`;
            const percentage = (score / totalQuestions) * 100;
            const feedbackMessage = document.getElementById('feedback-message');
            if (percentage === 100) {
                feedbackMessage.innerText = 'ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼ç´ æ™´ã‚‰ã—ã„ï¼ğŸ‰';
                feedbackMessage.className = 'text-lg mt-2 font-medium text-amber-500';
            } else if (percentage >= 80) {
                feedbackMessage.innerText = 'ã™ã”ã„ï¼ã‚ã¨ã‚‚ã†å°‘ã—ï¼';
                feedbackMessage.className = 'text-lg mt-2 font-medium text-sky-600';
            } else if (percentage >= 50) {
                feedbackMessage.innerText = 'ã‚ˆãã§ãã¾ã—ãŸï¼é–“é•ãˆãŸã¨ã“ã‚ã‚’å¾©ç¿’ã—ã‚ˆã†ã€‚';
                feedbackMessage.className = 'text-lg mt-2 font-medium text-slate-700';
            } else {
                feedbackMessage.innerText = 'é ‘å¼µã‚ã†ï¼ç¹°ã‚Šè¿”ã—æŒ‘æˆ¦ã™ã‚‹ã“ã¨ãŒå¤§äº‹ã ã‚ˆã€‚';
                feedbackMessage.className = 'text-lg mt-2 font-medium text-red-500';
            }
            renderMistakeList("mistake-list-container", mistakes);
            const reviewBtn = document.getElementById('review-btn');
            if (mistakes.length > 0) {
                reviewBtn.classList.remove('hidden');
            } else {
                reviewBtn.classList.add('hidden');
            }
        }

        function renderMistakeList(containerId, list) {
            const container = document.getElementById(containerId);
            if (list.length === 0) {
                container.innerHTML = `<p class="text-green-700 mt-2">é–“é•ã„ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼</p>`;
                return;
            }
            let html = '<div class="overflow-x-auto"><table class="mx-auto mt-2 text-left border-collapse"><thead><tr><th class="px-2 py-1 border-b">æ—¥æœ¬èª</th><th class="px-2 py-1 border-b">ã‚ãªãŸã®ç­”ãˆ</th><th class="px-2 py-1 border-b">æ­£è§£</th></tr></thead><tbody>';
            for (const m of list) {
                html += `<tr>
                    <td class="px-2 py-1 border-b">${m.question}</td>
                    <td class="px-2 py-1 border-b text-red-600">${m.userAnswer || '-'}</td>
                    <td class="px-2 py-1 border-b text-green-600">${m.answer}</td>
                </tr>`;
            }
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        function showCurrentMistakes() {
            document.getElementById('mistake-check-container').classList.remove('hidden');
            renderMistakeList("current-mistake-list", mistakes);
            // mid-review-btnã®è¡¨ç¤ºåˆ¶å¾¡
            const midReviewBtn = document.getElementById('mid-review-btn');
            if (mistakes.length === 0) {
                midReviewBtn.disabled = true;
                midReviewBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                midReviewBtn.disabled = false;
                midReviewBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        function closeMistakeCheck() {
            document.getElementById('mistake-check-container').classList.add('hidden');
        }

        // å¾©ç¿’ãƒœã‚¿ãƒ³ï¼ˆãƒ†ã‚¹ãƒˆçµ‚äº†ç”¨ï¼‰
        document.getElementById('review-btn').addEventListener('click', function() {
            if (mistakes.length === 0) return;
            reviewMode = true;
            reviewQuestions = mistakes.map(m => ({
                question: m.question,
                answer: m.answer
            }));
            initializeQuiz(reviewQuestions);
        });

        // é€”ä¸­å¾©ç¿’ãƒœã‚¿ãƒ³
        document.getElementById('mid-review-btn').addEventListener('click', function() {
            if (mistakes.length === 0) return;
            reviewMode = true;
            reviewQuestions = mistakes.map(m => ({
                question: m.question,
                answer: m.answer
            }));
            closeMistakeCheck();
            initializeQuiz(reviewQuestions);
        });

        document.getElementById('check-btn').addEventListener('click', checkAnswer);
        document.getElementById('next-btn').addEventListener('click', nextQuestion);
        document.getElementById('reset-btn').addEventListener('click', () => {
            reviewMode = false;
            initializeQuiz();
        });
        document.getElementById('mistake-check-btn').addEventListener('click', showCurrentMistakes);
        document.getElementById('close-mistake-check').addEventListener('click', closeMistakeCheck);

        window.onload = () => initializeQuiz();
    </script>
</body>
</html>
