<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>二学期中間考査ユメタン</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', 'Helvetica Neue', 'Arial', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', 'BIZ UDPGothic', sans-serif;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 p-4 sm:p-6 md:p-8">
    <div class="max-w-xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-900">二学期中間考査ユメタン</h1>
            <p class="mt-2 text-slate-600">日本語の意味に合う英単語を書いてみよう！</p>
        </header>

        <!-- Quiz Area -->
        <div id="quiz-area" class="bg-white p-6 rounded-xl shadow-md min-h-[300px] flex flex-col justify-between">
            <div id="progress-indicator" class="text-right text-sm text-slate-500 mb-4 font-medium"></div>
            <div id="question-container" class="text-lg flex-grow flex flex-col justify-center">
                <!-- Question content will be injected here -->
            </div>
            <div id="feedback-container" class="mt-4 font-bold text-center h-12">
                <!-- Feedback like "Correct!" or "Incorrect" will appear here -->
            </div>
        </div>

        <!-- 結果表示エリア -->
        <div id="result-container" class="hidden mt-8 text-center bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-3xl font-bold text-slate-800">テスト結果</h2>
            <p id="score" class="text-2xl mt-4"></p>
            <p id="feedback-message" class="text-lg mt-2 font-medium"></p>
            <!-- 間違えた単語リスト -->
            <div id="mistake-list-container" class="mt-6"></div>
            <!-- 復習ボタン -->
            <button id="review-btn" class="bg-pink-500 text-white font-bold py-2 px-6 rounded-lg mt-4 hover:bg-pink-600 transition hidden">間違えた問題だけ復習する</button>
        </div>

        <!-- 途中確認エリア -->
        <div id="mistake-check-container" class="hidden mt-8 text-center bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-2xl font-bold text-slate-800 mb-2">間違った単語リスト（ここまで）</h2>
            <div id="current-mistake-list" class="mb-4"></div>
            <button id="close-mistake-check" class="bg-sky-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-sky-600 transition">閉じる</button>
            <!-- 追加：ここまでの間違いで復習ボタン -->
            <button id="mid-review-btn" class="bg-pink-500 text-white font-bold py-2 px-6 rounded-lg mt-4 hover:bg-pink-600 transition">ここまでの間違いだけで復習する</button>
        </div>

        <!-- 操作ボタン -->
        <div id="control-buttons" class="mt-6 text-center space-x-2 sm:space-x-4">
            <button id="check-btn" class="bg-sky-600 text-white font-bold py-3 px-6 sm:px-8 rounded-lg shadow-md hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-50 transition-transform transform hover:scale-105">回答を確認</button>
            <button id="next-btn" class="bg-green-600 text-white font-bold py-3 px-6 sm:px-8 rounded-lg shadow-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition-transform transform hover:scale-105 hidden">次の問題へ</button>
            <button id="mistake-check-btn" class="bg-yellow-500 text-white font-bold py-3 px-4 sm:px-6 text-sm sm:text-base rounded-lg shadow-md hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:ring-opacity-50 transition-transform transform hover:scale-105">途中の間違い確認</button>
            <button id="reset-btn" class="bg-slate-500 text-white font-bold py-3 px-6 sm:px-8 rounded-lg shadow-md hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-opacity-50 transition-transform transform hover:scale-105">もう一度</button>
        </div>
    </div>

    <script>
        // 問題データ
        const wordList = [
            {"en":"peninsula","ja":"半島"},{"en":"approach","ja":"〜に近づく"},{"en":"citizen","ja":"市民"},{"en":"pavement","ja":"舗装道路"},{"en":"assume","ja":"〜を想定する"},{"en":"slave","ja":"奴隷"},{"en":"origin","ja":"起源"},{"en":"separate","ja":"〜を分ける"},{"en":"progress","ja":"進歩"},{"en":"profit","ja":"利益"},
            {"en":"voyage","ja":"航海"},{"en":"found","ja":"〜の基礎を築く"},{"en":"tribe","ja":"種族"},{"en":"transportation","ja":"移動手段"},{"en":"mankind","ja":"人類"},{"en":"heritage","ja":"遺産"},{"en":"descendant","ja":"子孫"},{"en":"civilization","ja":"文明"},{"en":"era","ja":"時代"},{"en":"appear","ja":"現れる"},
            {"en":"congress","ja":"議会"},{"en":"district","ja":"地区"},{"en":"colony","ja":"植民地"},{"en":"destination","ja":"目的地"},{"en":"declare","ja":"〜を宣言する"},{"en":"ape","ja":"類人猿"},{"en":"cliff","ja":"崖"},{"en":"afford","ja":"〜する余裕がある"},{"en":"tradition","ja":"伝統"},{"en":"prosperity","ja":"繁栄"},
            {"en":"nationality","ja":"国籍"},{"en":"occupation","ja":"職業"},{"en":"term","ja":"専門用語"},{"en":"province","ja":"地方"},{"en":"ruin","ja":"〜を破滅させる"},{"en":"translate","ja":"〜を翻訳する"},{"en":"ancestor","ja":"先祖"},{"en":"fare","ja":"運賃"},{"en":"remain","ja":"依然として〜のままである"},{"en":"media","ja":"マスメディア"},
            // ...（全リスト貼り付けてください）
            {"en":"score","ja":"得点"}
        ];

        // クイズ進行用グローバル変数
        let allQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let mistakes = [];
        let reviewMode = false;
        let reviewQuestions = [];

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function initializeQuiz(questions = null) {
            if (questions) {
                allQuestions = shuffle(questions.map(q => ({...q})));
            } else {
                allQuestions = shuffle(wordList.map(word => ({
                    question: word.ja,
                    answer: word.en
                })));
            }
            currentQuestionIndex = 0;
            score = 0;
            mistakes = [];
            document.getElementById('quiz-area').classList.remove('hidden');
            document.getElementById('control-buttons').classList.remove('hidden');
            document.getElementById('result-container').classList.add('hidden');
            document.getElementById('mistake-check-container').classList.add('hidden');
            displayQuestion();
        }

        function displayQuestion() {
            if (currentQuestionIndex >= allQuestions.length) {
                showResults();
                return;
            }
            document.getElementById('progress-indicator').textContent = `問題 ${currentQuestionIndex + 1} / ${allQuestions.length}`;
            const questionContainer = document.getElementById('question-container');
            const feedbackContainer = document.getElementById('feedback-container');
            questionContainer.innerHTML = '';
            feedbackContainer.innerHTML = '';
            const q = allQuestions[currentQuestionIndex];
            const questionHTML = `
                <label for="spell-input" class="block text-center text-xl font-medium text-slate-700 mb-4">${q.question}</label>
                <div class="relative max-w-sm mx-auto">
                    <input type="text" id="spell-input" class="text-center mt-1 block w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-sky-500 focus:border-sky-500 sm:text-lg" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
                </div>
            `;
            questionContainer.innerHTML = questionHTML;
            document.getElementById('check-btn').classList.remove('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            const spellInput = document.getElementById('spell-input');
            spellInput.focus();
            spellInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('check-btn').click();
                }
            });
        }

        function checkAnswer() {
            const q = allQuestions[currentQuestionIndex];
            const feedbackContainer = document.getElementById('feedback-container');
            const input = document.getElementById('spell-input');
            const userAnswer = input.value.trim().toLowerCase();
            const isCorrect = (userAnswer === q.answer.toLowerCase());
            input.disabled = true;
            if (isCorrect) {
                score++;
                feedbackContainer.innerHTML = `<span class="text-green-600 text-2xl">正解！ ○</span>`;
            } else {
                feedbackContainer.innerHTML = `<span class="text-red-600 text-2xl">不正解 ×</span><p class="text-slate-700 mt-1">正解は: ${q.answer}</p>`;
                mistakes.push({
                    question: q.question,
                    answer: q.answer,
                    userAnswer: input.value
                });
            }
            document.getElementById('check-btn').classList.add('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
            document.getElementById('next-btn').focus();
        }

        function nextQuestion() {
            currentQuestionIndex++;
            displayQuestion();
        }

        function showResults() {
            document.getElementById('quiz-area').classList.add('hidden');
            document.getElementById('control-buttons').classList.add('hidden');
            const resultContainer = document.getElementById('result-container');
            resultContainer.classList.remove('hidden');
            const totalQuestions = allQuestions.length;
            document.getElementById('score').innerText = `正解数: ${score} / ${totalQuestions}`;
            const percentage = (score / totalQuestions) * 100;
            const feedbackMessage = document.getElementById('feedback-message');
            if (percentage === 100) {
                feedbackMessage.innerText = 'パーフェクト！素晴らしい！🎉';
                feedbackMessage.className = 'text-lg mt-2 font-medium text-amber-500';
            } else if (percentage >= 80) {
                feedbackMessage.innerText = 'すごい！あともう少し！';
                feedbackMessage.className = 'text-lg mt-2 font-medium text-sky-600';
            } else if (percentage >= 50) {
                feedbackMessage.innerText = 'よくできました！間違えたところを復習しよう。';
                feedbackMessage.className = 'text-lg mt-2 font-medium text-slate-700';
            } else {
                feedbackMessage.innerText = '頑張ろう！繰り返し挑戦することが大事だよ。';
                feedbackMessage.className = 'text-lg mt-2 font-medium text-red-500';
            }
            renderMistakeList("mistake-list-container", mistakes);
            const reviewBtn = document.getElementById('review-btn');
            if (mistakes.length > 0) {
                reviewBtn.classList.remove('hidden');
            } else {
                reviewBtn.classList.add('hidden');
            }
        }

        function renderMistakeList(containerId, list) {
            const container = document.getElementById(containerId);
            if (list.length === 0) {
                container.innerHTML = `<p class="text-green-700 mt-2">間違いはありませんでした！</p>`;
                return;
            }
            let html = '<div class="overflow-x-auto"><table class="mx-auto mt-2 text-left border-collapse"><thead><tr><th class="px-2 py-1 border-b">日本語</th><th class="px-2 py-1 border-b">あなたの答え</th><th class="px-2 py-1 border-b">正解</th></tr></thead><tbody>';
            for (const m of list) {
                html += `<tr>
                    <td class="px-2 py-1 border-b">${m.question}</td>
                    <td class="px-2 py-1 border-b text-red-600">${m.userAnswer || '-'}</td>
                    <td class="px-2 py-1 border-b text-green-600">${m.answer}</td>
                </tr>`;
            }
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        function showCurrentMistakes() {
            document.getElementById('mistake-check-container').classList.remove('hidden');
            renderMistakeList("current-mistake-list", mistakes);
            // mid-review-btnの表示制御
            const midReviewBtn = document.getElementById('mid-review-btn');
            if (mistakes.length === 0) {
                midReviewBtn.disabled = true;
                midReviewBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                midReviewBtn.disabled = false;
                midReviewBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        function closeMistakeCheck() {
            document.getElementById('mistake-check-container').classList.add('hidden');
        }

        // 復習ボタン（テスト終了用）
        document.getElementById('review-btn').addEventListener('click', function() {
            if (mistakes.length === 0) return;
            reviewMode = true;
            reviewQuestions = mistakes.map(m => ({
                question: m.question,
                answer: m.answer
            }));
            initializeQuiz(reviewQuestions);
        });

        // 途中復習ボタン
        document.getElementById('mid-review-btn').addEventListener('click', function() {
            if (mistakes.length === 0) return;
            reviewMode = true;
            reviewQuestions = mistakes.map(m => ({
                question: m.question,
                answer: m.answer
            }));
            closeMistakeCheck();
            initializeQuiz(reviewQuestions);
        });

        document.getElementById('check-btn').addEventListener('click', checkAnswer);
        document.getElementById('next-btn').addEventListener('click', nextQuestion);
        document.getElementById('reset-btn').addEventListener('click', () => {
            reviewMode = false;
            initializeQuiz();
        });
        document.getElementById('mistake-check-btn').addEventListener('click', showCurrentMistakes);
        document.getElementById('close-mistake-check').addEventListener('click', closeMistakeCheck);

        window.onload = () => initializeQuiz();
    </script>
</body>
</html>
